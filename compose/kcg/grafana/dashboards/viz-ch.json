{
  "annotations": {
    "list": [
      {
        "$$hashKey": "object:631",
        "builtIn": 1,
        "datasource": {
          "type": "datasource",
          "uid": "grafana"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "target": {
          "limit": 100,
          "matchAny": false,
          "tags": [],
          "type": "dashboard"
        },
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fill": 1,
      "fillGradient": 0,
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "hiddenSeries": false,
      "id": 2,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "maxDataPoints": 200,
      "nullPointMode": "null",
      "options": {
        "dataLinks": [],
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT\n    t,\n    sum(sumbytes) AS sumbytes\nFROM (\n    SELECT\n        $timeSeries AS t,\n        sum(bytes*sampling_rate) as sumbytes\n    FROM $table\n    WHERE $timeFilter\n    GROUP BY t\n\n    UNION ALL\n\n    SELECT\n        intDiv($from+number*$interval, $interval)*$interval*1000 AS t,\n        0 AS sumbytes\n    FROM numbers(intDiv($to-$from, $interval))\n)\nGROUP BY t\nORDER BY t",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    t,\n    sum(sumbytes) AS sumbytes\nFROM (\n    SELECT\n        $timeSeries AS t,\n        sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\n    FROM $table\n    WHERE $timeFilter and ((etype = 0x800) and (equals($srcip, 'All') or (IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))) = $srcip)))\n    GROUP BY t\n\n    UNION ALL\n\n    SELECT\n        toInt64(intDiv($from+number*$interval, $interval)*$interval*1000) AS t,\n        0 AS sumbytes\n    FROM numbers(intDiv($to-$from, $interval))\n)\nGROUP BY t\nORDER BY t",
          "rawQuery": "SELECT\n    t,\n    sum(sumbytes) AS sumbytes\nFROM (\n    SELECT\n        (intDiv(toFloat64(time_flow_start_ns) * 1000, (300 * 1000)) * (300 * 1000)) AS t,\n        sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\n    FROM default.flows_raw\n    WHERE date >= toDate(1719800042) AND date <= toDate(1719886442) AND time_flow_start_ns >= toDateTime64(1719800042, 3) AND time_flow_start_ns <= toDateTime64(1719886442, 3) and ((etype = 0x800) and (equals('0.0.0.0', 'All') or (IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))) = '0.0.0.0')))\n    GROUP BY t\n\n    UNION ALL\n\n    SELECT\n        toInt64(intDiv(1719800042+number*300, 300)*300*1000) AS t,\n        0 AS sumbytes\n    FROM numbers(intDiv(1719886442-1719800042, 300))\n)\nGROUP BY t\nORDER BY t",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "bytes"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "date_inserted",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Instant traffic",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "sumbytes"
            },
            "properties": [
              {
                "id": "unit",
                "value": "decbytes"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "srcip"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 201
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "dstip"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 174
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 0,
        "y": 9
      },
      "id": 13,
      "links": [],
      "options": {
        "footer": {
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "9.3.6",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY srcip, dstip\nORDER BY sumbytes DESC",
          "rawQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE time_flow_start_ns >= toDateTime64(1719296079, 3) AND time_flow_start_ns <= toDateTime64(1719296379, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY srcip, dstip\nORDER BY sumbytes DESC",
          "rawSql": "SELECT src_ip, count(*), sum(bytes) AS sumBytes FROM flows GROUP BY src_ip",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top source and destination IPs",
      "type": "table"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": []
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "sumbytes"
            },
            "properties": [
              {
                "id": "unit",
                "value": "decbytes"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 12,
        "y": 9
      },
      "id": 22,
      "links": [],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "pieType": "pie",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "limit": 10,
          "values": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "9.3.6",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY srcip, dstip\nORDER BY sumbytes DESC",
          "rawQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE time_flow_start_ns >= toDateTime64(1719296079, 3) AND time_flow_start_ns <= toDateTime64(1719296379, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY srcip, dstip\nORDER BY sumbytes DESC",
          "rawSql": "SELECT src_ip, count(*), sum(bytes) AS sumBytes FROM flows GROUP BY src_ip",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top source and destination IPs",
      "type": "piechart"
    },
    {
      "columns": [],
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 16
      },
      "id": 7,
      "links": [],
      "options": {
        "footer": {
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": [
          {
            "desc": true,
            "displayName": "srcip"
          }
        ]
      },
      "pluginVersion": "9.3.6",
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 1,
        "desc": true
      },
      "styles": [
        {
          "alias": "Time",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "Time",
          "type": "date"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": ".*_port",
          "thresholds": [],
          "type": "number",
          "unit": "none"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "sumbytes",
          "thresholds": [],
          "type": "number",
          "unit": "decbytes"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 0,
          "pattern": "/.*/",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        }
      ],
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY srcip\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY srcip\nORDER BY sumbytes DESC",
          "rawQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719473440) AND date <= toDate(1719559840) AND time_flow_start_ns >= toDateTime64(1719473440, 3) AND time_flow_start_ns <= toDateTime64(1719559840, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY srcip\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top source IPs",
      "transform": "table",
      "type": "table"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": []
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 16
      },
      "id": 15,
      "links": [],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "pieType": "pie",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "limit": 10,
          "values": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "9.3.6",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY srcip\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY srcip\nORDER BY sumbytes DESC",
          "rawQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719296090) AND date <= toDate(1719296390) AND time_flow_start_ns >= toDateTime64(1719296090, 3) AND time_flow_start_ns <= toDateTime64(1719296390, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY srcip\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top source IPs",
      "type": "piechart"
    },
    {
      "columns": [],
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 25
      },
      "id": 10,
      "links": [],
      "options": {
        "footer": {
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "9.3.6",
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 1,
        "desc": true
      },
      "styles": [
        {
          "alias": "Time",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "Time",
          "type": "date"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": ".*_port",
          "thresholds": [],
          "type": "number",
          "unit": "none"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "sumbytes",
          "thresholds": [],
          "type": "number",
          "unit": "decbytes"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 0,
          "pattern": "/.*/",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        }
      ],
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY dstip\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY dstip\nORDER BY sumbytes DESC",
          "rawQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719296117) AND date <= toDate(1719296417) AND time_flow_start_ns >= toDateTime64(1719296117, 3) AND time_flow_start_ns <= toDateTime64(1719296417, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY dstip\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top destination IPs",
      "transform": "table",
      "type": "table"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": []
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 25
      },
      "id": 17,
      "links": [],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "pieType": "pie",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "limit": 10,
          "values": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "9.3.6",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY dstip\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY dstip\nORDER BY sumbytes DESC",
          "rawQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(dst_addr), 13,4))), IPv6NumToString(dst_addr)) as dstip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719296117) AND date <= toDate(1719296417) AND time_flow_start_ns >= toDateTime64(1719296117, 3) AND time_flow_start_ns <= toDateTime64(1719296417, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY dstip\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top destination IPs",
      "type": "piechart"
    },
    {
      "columns": [],
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 34
      },
      "id": 19,
      "links": [],
      "options": {
        "footer": {
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "9.3.6",
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 1,
        "desc": true
      },
      "styles": [
        {
          "$$hashKey": "object:1506",
          "alias": "Time",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "Time",
          "type": "date"
        },
        {
          "$$hashKey": "object:1507",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": "port",
          "thresholds": [],
          "type": "number",
          "unit": "none"
        },
        {
          "$$hashKey": "object:1508",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "sumbytes",
          "thresholds": [],
          "type": "number",
          "unit": "decbytes"
        },
        {
          "$$hashKey": "object:1509",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 0,
          "pattern": "/.*/",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        }
      ],
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(src_port) as port,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY port\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(src_port) as port,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY port\nORDER BY sumbytes DESC",
          "rawQuery": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(src_port) as port,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719296099) AND date <= toDate(1719296399) AND time_flow_start_ns >= toDateTime64(1719296099, 3) AND time_flow_start_ns <= toDateTime64(1719296399, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY port\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top source ports",
      "transform": "table",
      "type": "table"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 34
      },
      "id": 9,
      "links": [],
      "options": {
        "displayMode": "gradient",
        "minVizHeight": 10,
        "minVizWidth": 0,
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/^sumbytes$/",
          "limit": 9,
          "values": true
        },
        "showUnfilled": true
      },
      "pluginVersion": "9.3.6",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(src_port) as port,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY port\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(src_port) as port,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY port\nORDER BY sumbytes DESC",
          "rawQuery": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(src_port) as port,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719296099) AND date <= toDate(1719296399) AND time_flow_start_ns >= toDateTime64(1719296099, 3) AND time_flow_start_ns <= toDateTime64(1719296399, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY port\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top source ports",
      "type": "bargauge"
    },
    {
      "columns": [],
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 43
      },
      "id": 21,
      "links": [],
      "options": {
        "footer": {
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "9.3.6",
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 1,
        "desc": false
      },
      "styles": [
        {
          "$$hashKey": "object:1428",
          "alias": "Time",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "Time",
          "type": "date"
        },
        {
          "$$hashKey": "object:1429",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": "port",
          "thresholds": [],
          "type": "number",
          "unit": "none"
        },
        {
          "$$hashKey": "object:1430",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "sumbytes",
          "thresholds": [],
          "type": "number",
          "unit": "decbytes"
        },
        {
          "$$hashKey": "object:1431",
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 0,
          "pattern": "/.*/",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        }
      ],
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(dst_port) as port,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY port\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(dst_port) as port,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY port\nORDER BY sumbytes DESC",
          "rawQuery": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(dst_port) as port,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719296126) AND date <= toDate(1719296426) AND time_flow_start_ns >= toDateTime64(1719296126, 3) AND time_flow_start_ns <= toDateTime64(1719296426, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY port\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top destination ports",
      "transform": "table",
      "type": "table"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 43
      },
      "id": 11,
      "links": [],
      "options": {
        "displayMode": "lcd",
        "minVizHeight": 10,
        "minVizWidth": 0,
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/^sumbytes$/",
          "limit": 10,
          "values": true
        },
        "showUnfilled": true
      },
      "pluginVersion": "9.3.6",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(dst_port) as port,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY port\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(dst_port) as port,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY port\nORDER BY sumbytes DESC",
          "rawQuery": "WITH dictGetString('dictionaries.protocols', 'name', toUInt64(proto)) AS protoName\nSELECT\n    if(protoName = '', toString(proto), protoName) || '/' || toString(dst_port) as port,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719296126) AND date <= toDate(1719296426) AND time_flow_start_ns >= toDateTime64(1719296126, 3) AND time_flow_start_ns <= toDateTime64(1719296426, 3) and ((etype = 0x800) or (etype = 0x86dd))\nGROUP BY port\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top destination ports",
      "type": "bargauge"
    },
    {
      "columns": [],
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "fontSize": "100%",
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 52
      },
      "id": 23,
      "links": [],
      "options": {
        "footer": {
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "9.3.6",
      "scroll": true,
      "showHeader": true,
      "sort": {
        "col": 1,
        "desc": true
      },
      "styles": [
        {
          "alias": "Time",
          "align": "auto",
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "pattern": "Time",
          "type": "date"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 0,
          "mappingType": 1,
          "pattern": ".*_port",
          "thresholds": [],
          "type": "number",
          "unit": "none"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "dateFormat": "YYYY-MM-DD HH:mm:ss",
          "decimals": 2,
          "mappingType": 1,
          "pattern": "sumbytes",
          "thresholds": [],
          "type": "number",
          "unit": "decbytes"
        },
        {
          "alias": "",
          "align": "auto",
          "colors": [
            "rgba(245, 54, 54, 0.9)",
            "rgba(237, 129, 40, 0.89)",
            "rgba(50, 172, 45, 0.97)"
          ],
          "decimals": 0,
          "pattern": "/.*/",
          "thresholds": [],
          "type": "number",
          "unit": "short"
        }
      ],
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY srcip\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    IPv6NumToString(in_src_addr) as in_srcip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd)) and (hex(in_src_addr) != '00000000000000000000000000000000')\nGROUP BY srcip, in_srcip\nORDER BY sumbytes DESC",
          "rawQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    IPv6NumToString(in_src_addr) as in_srcip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719278452) AND date <= toDate(1719364852) AND time_flow_start_ns >= toDateTime64(1719278452, 3) AND time_flow_start_ns <= toDateTime64(1719364852, 3) and ((etype = 0x800) or (etype = 0x86dd)) and (hex(in_src_addr) != '00000000000000000000000000000000')\nGROUP BY srcip, in_srcip\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top source IPs and inner source IPs",
      "transform": "table",
      "type": "table"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "PDEE91DDB90597936"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": []
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 52
      },
      "id": 24,
      "links": [],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "pieType": "pie",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "limit": 10,
          "values": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "9.3.6",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "PDEE91DDB90597936"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeColDataType": "time_flow_start_ns",
          "dateTimeType": "DATETIME64",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    sum(bytes*sampling_rate) AS sumbytes\nFROM $table\nWHERE $timeFilter\nGROUP BY srcip\nORDER BY sumbytes DESC",
          "group": [],
          "intervalFactor": 1,
          "metricColumn": "none",
          "query": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    IPv6NumToString(in_src_addr) as in_srcip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM $table\nWHERE $timeFilter and ((etype = 0x800) or (etype = 0x86dd)) and (hex(in_src_addr) != '00000000000000000000000000000000')\nGROUP BY srcip, in_srcip\nORDER BY sumbytes DESC",
          "rawQuery": "SELECT\n    if(etype = 0x800, IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))), IPv6NumToString(src_addr)) as srcip,\n    IPv6NumToString(in_src_addr) as in_srcip,\n    sum(if(sampling_rate =0, bytes, bytes * sampling_rate)) as sumbytes\nFROM default.flows_raw\nWHERE date >= toDate(1719278452) AND date <= toDate(1719364852) AND time_flow_start_ns >= toDateTime64(1719278452, 3) AND time_flow_start_ns <= toDateTime64(1719364852, 3) and ((etype = 0x800) or (etype = 0x86dd)) and (hex(in_src_addr) != '00000000000000000000000000000000')\nGROUP BY srcip, in_srcip\nORDER BY sumbytes DESC",
          "refId": "A",
          "round": "0s",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "skip_comments": true,
          "table": "flows_raw",
          "tableLoading": false,
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top source IPs and inner source IPs",
      "type": "piechart"
    }
  ],
  "refresh": "",
  "schemaVersion": 37,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "allValue": "'All'",
        "current": {
          "selected": true,
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "vertamedia-clickhouse-datasource",
          "uid": "PDEE91DDB90597936"
        },
        "definition": "select sip from (\nselect IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))) as sip, time_flow_start_ns from flows_raw where etype = 0x800 group by sip, time_flow_start_ns order by time_flow_start_ns DESC limit 1 by sip limit 10)\n",
        "description": "IPv4 only",
        "hide": 0,
        "includeAll": true,
        "label": "Filter by Source IP",
        "multi": false,
        "name": "srcip",
        "options": [],
        "query": "select sip from (\nselect IPv4NumToString(reinterpretAsUInt32(substring(reverse(src_addr), 13,4))) as sip, time_flow_start_ns from flows_raw where etype = 0x800 group by sip, time_flow_start_ns order by time_flow_start_ns DESC limit 1 by sip limit 10)\n",
        "refresh": 2,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ],
    "time_options": [
      "5m",
      "15m",
      "1h",
      "6h",
      "12h",
      "24h",
      "2d",
      "7d",
      "30d"
    ]
  },
  "timezone": "",
  "title": "Traffic (ClickHouse)",
  "uid": "tkNEAd9Zk",
  "version": 2,
  "weekStart": ""
}
